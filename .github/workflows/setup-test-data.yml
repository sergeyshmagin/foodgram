name: Setup Test Data

on:
  workflow_dispatch:
    inputs:
      confirm:
        description: 'Type "yes" to confirm test data loading'
        required: true
        default: 'no'

env:
  PROD_HOST: 89.169.174.76

jobs:
  setup-test-data:
    name: Load test data to production
    runs-on: ubuntu-latest
    if: github.event.inputs.confirm == 'yes'
    
    steps:
    - name: Setup test data on production server
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.PROD_HOST }}
        username: ${{ secrets.PROD_USER }}
        key: ${{ secrets.PROD_SSH_KEY }}
        script: |
          set -e
          echo "=== –ó–ê–ì–†–£–ó–ö–ê –¢–ï–°–¢–û–í–´–• –î–ê–ù–ù–´–• ==="
          
          cd $HOME/foodgram
          
          echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
          sudo docker compose -f infra/docker-compose.yml ps
          
          echo "–ó–∞–≥—Ä—É–∂–∞–µ–º –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–∞–¥–º–∏–Ω, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Ç–µ–≥–∏, –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã)..."
          sudo docker compose -f infra/docker-compose.yml exec -T backend python manage.py setup_foodgram
          
          echo "–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ (—Ä–µ—Ü–µ–ø—Ç—ã, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è)..."
          sudo docker compose -f infra/docker-compose.yml exec -T backend python manage.py load_demo_data
          
          echo "‚úÖ –¢–ï–°–¢–û–í–´–ï –î–ê–ù–ù–´–ï –ó–ê–ì–†–£–ñ–ï–ù–´!"
          echo ""
          echo "üìã –ê–ö–ö–ê–£–ù–¢–´ –î–õ–Ø –í–•–û–î–ê:"
          echo "üë§ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: admin@foodgram.ru / admin123"
          echo "üë§ –®–µ—Ñ-–ø–æ–≤–∞—Ä: chef@foodgram.ru / testpass123"  
          echo "üë§ –ú–∞—Ä–∏—è: maria@foodgram.ru / testpass123"
          echo "üë§ –¢–µ—Å—Ç–æ–≤—ã–π: test@foodgram.ru / testpass123"
          echo ""
          echo "üåê Admin –ø–∞–Ω–µ–ª—å: https://foodgram.freedynamicdns.net/admin/" 